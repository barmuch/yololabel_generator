"use strict";(()=>{var e={};e.id=871,e.ids=[871],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},20145:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>m,patchFetch:()=>D,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>j,staticGenerationAsyncStorage:()=>g});var r={};o.r(r),o.d(r,{GET:()=>u,POST:()=>p});var n=o(49303),s=o(88716),a=o(60670),i=o(87070),c=o(2021);async function u(){try{console.log("\uD83D\uDD0D Fetching all projects from MongoDB...");let e=await (0,c.N8)(),t=await e.collection("projects").find({}).sort({updatedAt:-1}).toArray(),o=await Promise.all(t.map(async t=>{let o=await e.collection("images").countDocuments({projectId:t.id}),r=await e.collection("annotations").countDocuments({projectId:t.id});return{...t,imageCount:o,annotationCount:r}}));return console.log(`✅ Found ${o.length} projects in MongoDB`),i.NextResponse.json({success:!0,projects:o})}catch(e){return console.error("❌ Error fetching projects:",e),i.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to fetch projects"},{status:500})}}async function p(e){try{let t=await e.json();console.log("\uD83D\uDCBE Creating/updating project in MongoDB:",t.name);let o=await (0,c.N8)(),r={id:t.id,name:t.name,description:t.description||"",classes:t.classes||[],createdAt:t.createdAt||Date.now(),updatedAt:Date.now(),imageCount:t.imageCount||0,annotationCount:t.annotationCount||0},n=await o.collection("projects").replaceOne({id:t.id},r,{upsert:!0});return console.log(`✅ Project saved: ${n.upsertedId?"created":"updated"}`),i.NextResponse.json({success:!0,project:{...r,_id:n.upsertedId}})}catch(e){return console.error("❌ Error saving project:",e),i.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to save project"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/projects/route",pathname:"/api/projects",filename:"route",bundlePath:"app/api/projects/route"},resolvedPagePath:"D:\\Project\\next-yolo-label-generator\\app\\api\\projects\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:j}=l,m="/api/projects/route";function D(){return(0,a.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:g})}},2021:(e,t,o)=>{o.d(t,{N8:()=>a,vO:()=>i});var r=o(38013);let n=null,s=null;async function a(){if(s)return s;let e=process.env.MONGODB_URI;if(!e)throw Error("MONGODB_URI is not set in environment");return n||(n=new r.MongoClient(e),await n.connect()),s=n.db()}async function i(){let e=await a();if(!n)throw Error("Client not initialized");return{db:e,client:n}}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[948,972],()=>o(20145));module.exports=r})();